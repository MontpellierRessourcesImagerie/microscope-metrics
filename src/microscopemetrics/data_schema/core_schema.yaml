id: https://github.com/MontpellierRessourcesImagerie/microscope-metrics/blob/main/src/microscopemetrics/data_schema/core_schema.yaml
name: microscopemetrics_core_schema
prefixes:
#  metrics: https://github.com/MontpellierRessourcesImagerie/microscope-metrics/blob/main/src/microscopemetrics/model/
#imports:
#  - metrics:types
  NCIT: http://purl.obolibrary.org/obo/NCIT_
  linkml: https://w3id.org/linkml/
imports:
  - linkml:types
#  - ./samples/field_illum_schema

default_range: string


###
# Classes properties to consider
# - required: true
# - multivalued: true
# - range: string
# - minimum_value: 0
# - maximum_value: 255
# - identifier: true
# - abstract: true
# - tree_root: true
###

classes:
  NamedObject:
    description: An object with a name and a description
    abstract: true
    slots:
      - name
      - description

  MetricsObject:
    is_a: NamedObject
    description: A base object for all microscope-metrics objects
    abstract: true

  Sample:
    is_a: NamedObject
    description: A sample is a standard physical object that is imaged by a microscope
    attributes:
      type:   # TODO: develop the sample class
        required: true
      protocol:
        required: true
        multivalued: false
        range: Protocol

  Protocol:
    is_a: NamedObject
    description: Set of instructions for preparing and imaging a sample
    attributes:
      version:  # make slot
        required: true
      authors:
        range: Experimenter
        multivalued: true
      url:
        required: true

  Experimenter:
    description: The person that performed the experiment or developed the protocol
    attributes:
      name:  # make slot
        description: The name of the experimenter
        range: string
      orcid:  # make slot
        description: The ORCID of the experimenter
        identifier: true

  MetricsDataset:
    is_a: NamedObject
    description: A base object on which microscope-metrics runs the analysis
    tree_root: true
    attributes:
      sample:
        multivalued: true
        range: Sample
      experimenter:
        multivalued: true
        range: Experimenter

  MetricsInput:
    is_a: MetricsObject
    mixin: true
    description: A base object for all microscope-metrics inputs

  MetricsInputImage2D:
    mixins:
      - MetricsInput
      - Image2D
    description: A microscope-metrics input 2D-image

  MetricsInputImage5D:
    mixins:
      - MetricsInput
      - Image5D
    description: A microscope-metrics input 5D-image

  MetricsOutput:  # TODO: add conditional rules
    is_a: MetricsObject
    mixin: true
    description: A base object for all microscope-metrics outputs

  MetricsOutputImage2D:
    mixins:
      - MetricsOutput
      - Image2D
    description: A microscope-metrics output 2D-image

  MetricsOutputImage5D:
    mixins:
      - MetricsOutput
      - Image5D
    description: A microscope-metrics output 5D-image

  Image:
    description: A base object for all microscope-metrics output images
    abstract: true
    attributes:
      name:
        key: true
        required: true
        range: string
      data:
        implements:
          - linkml:elements
        multivalued: true
        required: true
        any_of:
          - range: float
          - range: integer
      roi:
        range: ROI
        multivalued: true

  ImageMask:
    is_a: Image
    description: A base object for all microscope-metrics output masks
    attributes:
      x_position:
        range: float
        ifabsent: float(0.0)
      y_position:
        range: float
        ifabsent: float(0.0)
      x:
        implements:
          - linkml:axis0
        range: PixelSeries
        required: true
      y:
        implements:
          - linkml:axis1
        range: PixelSeries
        required: true
      data:
        range: boolean

  Image2D:
    is_a: Image
    description: A 2D image in XY order
    implements:
      - linkml:TwoDimensionalArray
      - linkml:RowOrderedArray
    attributes:
      x:
        implements:
          - linkml:axis0
        range: PixelSeries
        required: true
      y:
        implements:
          - linkml:axis1
        range: PixelSeries
        required: true

  Image5D:
    is_a: Image
    description: A 5D image in TZYXC order
    implements:
      - linkml:FiveDimensionalArray
      - linkml:RowOrderedArray
    attributes:
      t:
        implements:
          - linkml:axis0
        range: TimeSeries
        required: true
      z:
        implements:
          - linkml:axis1
        range: PixelSeries
        required: true
      y:
        implements:
          - linkml:axis2
        range: PixelSeries
        required: true
      x:
        implements:
          - linkml:axis3
        range: PixelSeries
        required: true
      c:
        implements:
          - linkml:axis4
        range: ChannelSeries
        required: true

  PixelSeries:
    description: A series whose values represent pixels or voxels
    implements:
      - linkml:OneDimensionalSeries
    attributes:
      values:
        range: integer
        multivalued: true
        implements:
          - linkml:elements
        required: true
        unit:
          ucum_code: /[arb`U]

  Channel:
    description: A channel
    attributes:
      name:
        required: false
      rendering_color:
        required: false
        range: Color
      emission_wavelength:
        range: float
        unit:
          ucum_code: nm
      excitation_wavelength:
        range: float
        unit:
          ucum_code: nm

  ChannelSeries:
    description: A series whose values represent channel
    implements:
      - linkml:OneDimensionalSeries
    attributes:
      values:
        range: Channel
        multivalued: true
        implements:
          - linkml:elements
        required: true
#        unit:
#          ucum_code: /[arb`U]

  TimeSeries:
    description: A series whose values represent time
    implements:
      - linkml:OneDimensionalSeries
    attributes:
      values:
        range: float
        multivalued: true
        implements:
          - linkml:elements
        required: true
        unit:
          ucum_code: s

  ROI:
    description: A ROI. Collection of shapes
    attributes:
      shapes:
        multivalued: true
        range: Shape

  Shape:
    abstract: true
    description: A shape
    attributes:
      z:
        range: float
      c:
        range: integer
      t:
        range: integer
      fill_color:
        range: Color
      stroke_color:
        range: Color
      stroke_width:
        range: integer

  Point:
    is_a: Shape
    description: A point as defined by x and y coordinates
    attributes:
      x:
        multivalued: false
        range: float
      y:
        multivalued: false
        range: float

  Line:
    is_a: Shape
    description: A line as defined by x1, y1, x2, y2 coordinates
    attributes:
      x1:
        multivalued: false
        range: float
      y1:
        multivalued: false
        range: float
      x2:
        multivalued: false
        range: float
      x3:
        multivalued: false
        range: float

  Rectangle:
    is_a: Shape
    description: A rectangle as defined by x, y coordinates and width, height
    attributes:
      x:
        multivalued: false
        range: float
      y:
        multivalued: false
        range: float
      w:
        multivalued: false
        range: float
      h:
        multivalued: false
        range: float

  Ellipse:
    is_a: Shape
    description: An ellipse as defined by x, y coordinates and x and y radii
    attributes:
      x:
        multivalued: false
        range: float
      y:
        multivalued: false
        range: float
      x_rad:
        multivalued: false
        range: float
      y_rad:
        multivalued: false
        range: float

  Polygon:
    is_a: Shape
    description: >-
      A polygon as defined by a series of vertexes and a boolean to indicate if closed or not
    attributes:
      vertexes:
        multivalued: true
        required: true
        range: Vertex
      is_open:
        multivalued: false
        range: boolean
        ifabsent: False

  Vertex:
    description: A vertex as defined by x and y coordinates
    attributes:
      x:
        multivalued: false
        required: true
        range: float
      y:
        multivalued: false
        required: true
        range: float

  Mask: # review for arrays
    is_a: Shape
    description: A mask as defined by a boolean image
    attributes:
      mask:
        multivalued: false
        range: ImageMask

  Color:
    description: A color as defined by RGB values and an optional alpha value
    attributes:
      R:
        required: true
        multivalued: false
        range: integer
        minimum_value: 0
        maximum_value: 255
      G:
        required: true
        multivalued: false
        range: integer
        minimum_value: 0
        maximum_value: 255
      B:
        required: true
        multivalued: false
        range: integer
        minimum_value: 0
        maximum_value: 255
      alpha:
        required: false
        multivalued: false
        range: integer
        minimum_value: 0
        maximum_value: 255

  MetricsOutputKeyValues:
    mixins:
      - MetricsOutput
      - KeyValuesCollection
    description: A microscope-metrics output collection of key-value pairs

  KeyValuesCollection:
    description: A collection of key-value pairs
    attributes:
      key_values:
        required: true
        multivalued: true
        range: KeyValuePair
        inlined: true
        inlined_as_list: false

  KeyValuePair:
    description: A key-value pair
    attributes:
      name:
        key: true
        range: string
      value:
        range: string

  MetricsOutputTag:
    mixins:
      - MetricsOutput
      - Tag
    description: A microscope-metrics output tag

  Tag:
    description: A tag
    attributes:
      id:
        identifier: true
        required: true
        multivalued: false
        range: integer
      text:
        required: true
        multivalued: false
        range: string
      description:
        required: false
        multivalued: false
        range: string

  MetricsOutputComment:
    mixins:
      - MetricsOutput
      - Comment
    description: A microscope-metrics output comment

  Comment:
    description: A comment
    attributes:
      text:
        required: true
        multivalued: false
        range: string

  MetricsOutputTable:
    mixins:
      - MetricsOutput
      - Table
    description: A microscope-metrics output collection of tables

  Table:
    description: A table
    attributes:
      columns:
          required: true
          multivalued: true
          range: Column

  Column:
    description: A column
    attributes:
      name:
        required: true
        multivalued: false
        range: string
      values:
        required: true
        multivalued: true
        range: string


slots:
  id:
    description: The unique identifier for an entity
    identifier: true
    required: true
    multivalued: false
    range: string
  name:
    description: The name of an entity
    required: true
    multivalued: false
    range: string
  description:
    description: A description of an entity
    required: true
    multivalued: false
    range: string

types:
  PixelCountType:
    description: A pixel count as integer
    uri: NCIT:C48367  ## pixel
    typeof: integer
  PixelType:
    description: A unitless pixel as float
    uri: NCIT:C48367  ## pixel
    typeof: float

enums:
